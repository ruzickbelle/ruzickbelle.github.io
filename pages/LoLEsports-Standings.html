<!DOCTYPE html>
<html lang="en-GB">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>LoL Esports Ranking</title>
   <link rel="stylesheet" href="https://lolesports.com/index.css?v=0.1.1924">
   <style>
div#status {
   color: black;
}

#configOuter {
   position: absolute;
   bottom: 0;
   right: 0;
   min-height: 2cm;
   min-width: 2cm;
   background: inherit;
}

#configHint {
   width: 10em;
   background: inherit;
}

#configInner {
   display: none;
   background: inherit;
}

#configOuter:hover > #configInner {
   display: block;
}

div.right {
   text-align: right;
}

body.dragging, body.dragging * {
   cursor: move !important;
}

.dragged {
   position: absolute;
   opacity: 0.5;
   z-index: 2000;
}

ol.group li.placeholder {
   position: relative;
   /** More li styles **/
}
ol.group li.placeholder:before {
   position: absolute;
   /** Define arrowhead **/
}
   </style>
   <script>
// SOURCE: https://github.com/lukasoppermann/html5sortable
var sortable=function(){"use strict";function c(e,t,n){if(void 0===n)return e&&e.h5s&&e.h5s.data&&e.h5s.data[t];e.h5s=e.h5s||{},e.h5s.data=e.h5s.data||{},e.h5s.data[t]=n}var v=function(e,t){if(!(e instanceof NodeList||e instanceof HTMLCollection||e instanceof Array))throw new Error("You must provide a nodeList/HTMLCollection/Array of elements to be filtered.");return"string"!=typeof t?Array.from(e):Array.from(e).filter(function(e){return 1===e.nodeType&&e.matches(t)})},y=new Map,t=function(){function e(){this._config=new Map,this._placeholder=void 0,this._data=new Map}return Object.defineProperty(e.prototype,"config",{get:function(){var n={};return this._config.forEach(function(e,t){n[t]=e}),n},set:function(e){if("object"!=typeof e)throw new Error("You must provide a valid configuration object to the config setter.");var t=Object.assign({},e);this._config=new Map(Object.entries(t))},enumerable:!1,configurable:!0}),e.prototype.setConfig=function(e,t){if(!this._config.has(e))throw new Error("Trying to set invalid configuration item: "+e);this._config.set(e,t)},e.prototype.getConfig=function(e){if(!this._config.has(e))throw new Error("Invalid configuration item requested: "+e);return this._config.get(e)},Object.defineProperty(e.prototype,"placeholder",{get:function(){return this._placeholder},set:function(e){if(!(e instanceof HTMLElement)&&null!==e)throw new Error("A placeholder must be an html element or null.");this._placeholder=e},enumerable:!1,configurable:!0}),e.prototype.setData=function(e,t){if("string"!=typeof e)throw new Error("The key must be a string.");this._data.set(e,t)},e.prototype.getData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.get(e)},e.prototype.deleteData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.delete(e)},e}(),E=function(e){if(!(e instanceof HTMLElement))throw new Error("Please provide a sortable to the store function.");return y.has(e)||y.set(e,new t),y.get(e)};function i(e,t,n){if(e instanceof Array)for(var r=0;r<e.length;++r)i(e[r],t,n);else e.addEventListener(t,n),E(e).setData("event"+t,n)}function a(e,t){if(e instanceof Array)for(var n=0;n<e.length;++n)a(e[n],t);else e.removeEventListener(t,E(e).getData("event"+t)),E(e).deleteData("event"+t)}function l(e,t,n){if(e instanceof Array)for(var r=0;r<e.length;++r)l(e[r],t,n);else e.setAttribute(t,n)}function r(e,t){if(e instanceof Array)for(var n=0;n<e.length;++n)r(e[n],t);else e.removeAttribute(t)}var w=function(e){if(!e.parentElement||0===e.getClientRects().length)throw new Error("target element must be part of the dom");var t=e.getClientRects()[0];return{left:t.left+window.pageXOffset,right:t.right+window.pageXOffset,top:t.top+window.pageYOffset,bottom:t.bottom+window.pageYOffset}},d=function(n,r){var o;return void 0===r&&(r=0),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];clearTimeout(o),o=setTimeout(function(){n.apply(void 0,e)},r)}},b=function(e,t){if(!(e instanceof HTMLElement&&(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array)))throw new Error("You must provide an element and a list of elements.");return Array.from(t).indexOf(e)},f=function(e){if(!(e instanceof HTMLElement))throw new Error("Element is not a node element.");return null!==e.parentNode},n=function(e,t,n){if(!(e instanceof HTMLElement&&e.parentElement instanceof HTMLElement))throw new Error("target and element must be a node");e.parentElement.insertBefore(t,"before"===n?e:e.nextElementSibling)},T=function(e,t){return n(e,t,"before")},C=function(e,t){return n(e,t,"after")},o=function(t,n,e){if(void 0===n&&(n=function(e,t){return e}),void 0===e&&(e=function(e){return e}),!(t instanceof HTMLElement)||!0==!t.isSortable)throw new Error("You need to provide a sortableContainer to be serialized.");if("function"!=typeof n||"function"!=typeof e)throw new Error("You need to provide a valid serializer for items and the container.");var r=c(t,"opts").items,o=v(t.children,r),a=o.map(function(e){return{parent:t,node:e,html:e.outerHTML,index:b(e,o)}});return{container:e({node:t,itemCount:a.length}),items:a.map(function(e){return n(e,t)})}},u=function(e,t,n){var r;if(void 0===n&&(n="sortable-placeholder"),!(e instanceof HTMLElement))throw new Error("You must provide a valid element as a sortable.");if(!(t instanceof HTMLElement)&&void 0!==t)throw new Error("You must provide a valid element as a placeholder or set ot to undefined.");return void 0===t&&(["UL","OL"].includes(e.tagName)?t=document.createElement("li"):["TABLE","TBODY"].includes(e.tagName)?(t=document.createElement("tr")).innerHTML='<td colspan="100"></td>':t=document.createElement("div")),"string"==typeof n&&(r=t.classList).add.apply(r,n.split(" ")),t},L=function(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var n=window.getComputedStyle(e);return"border-box"===n.getPropertyValue("box-sizing")?parseInt(n.getPropertyValue("height"),10):["height","padding-top","padding-bottom"].map(function(e){var t=parseInt(n.getPropertyValue(e),10);return isNaN(t)?0:t}).reduce(function(e,t){return e+t})},x=function(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var n=window.getComputedStyle(e);return["width","padding-left","padding-right"].map(function(e){var t=parseInt(n.getPropertyValue(e),10);return isNaN(t)?0:t}).reduce(function(e,t){return e+t})},s=function(e,t){if(!(e instanceof Array))throw new Error("You must provide a Array of HTMLElements to be filtered.");return"string"!=typeof t?e:e.filter(function(e){return e.querySelector(t)instanceof HTMLElement||e.shadowRoot&&e.shadowRoot.querySelector(t)instanceof HTMLElement}).map(function(e){return e.querySelector(t)||e.shadowRoot&&e.shadowRoot.querySelector(t)})},p=function(e){return e.composedPath&&e.composedPath()[0]||e.target},m=function(e,t,n){return{element:e,posX:n.pageX-t.left,posY:n.pageY-t.top}},g=function(e,t,n){if(!(e instanceof Event))throw new Error("setDragImage requires a DragEvent as the first argument.");if(!(t instanceof HTMLElement))throw new Error("setDragImage requires the dragged element as the second argument.");if(n||(n=m),e.dataTransfer&&e.dataTransfer.setDragImage){var r=n(t,w(t),e);if(!(r.element instanceof HTMLElement)||"number"!=typeof r.posX||"number"!=typeof r.posY)throw new Error("The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].");e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",p(e).id),e.dataTransfer.setDragImage(r.element,r.posX,r.posY)}},M=function(e,t){if(!0===e.isSortable){var n=E(e).getConfig("acceptFrom");if(null!==n&&!1!==n&&"string"!=typeof n)throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.');if(null!==n)return!1!==n&&0<n.split(",").filter(function(e){return 0<e.length&&t.matches(e)}).length;if(e===t)return!0;if(void 0!==E(e).getConfig("connectWith")&&null!==E(e).getConfig("connectWith"))return E(e).getConfig("connectWith")===E(t).getConfig("connectWith")}return!1},D={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:!1,placeholder:null,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",hoverClass:!1,dropTargetContainerClass:!1,debounce:0,throttleTime:100,maxItems:0,itemSerializer:void 0,containerSerializer:void 0,customDragImage:null,orientation:"vertical"};var H,I,A,S,Y,_,O,P,z,h=function(e,t){if("string"==typeof E(e).getConfig("hoverClass")){var o=E(e).getConfig("hoverClass").split(" ");!0===t?(i(e,"mousemove",function(r,o){var a=this;if(void 0===o&&(o=250),"function"!=typeof r)throw new Error("You must provide a function as the first argument for throttle.");if("number"!=typeof o)throw new Error("You must provide a number as the second argument for throttle.");var i=null;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Date.now();(null===i||o<=n-i)&&(i=n,r.apply(a,e))}}(function(r){0===r.buttons&&v(e.children,E(e).getConfig("items")).forEach(function(e){var t,n;e===r.target||e.contains(r.target)?(t=e.classList).add.apply(t,o):(n=e.classList).remove.apply(n,o)})},E(e).getConfig("throttleTime"))),i(e,"mouseleave",function(){v(e.children,E(e).getConfig("items")).forEach(function(e){var t;(t=e.classList).remove.apply(t,o)})})):(a(e,"mousemove"),a(e,"mouseleave"))}},N=function(e){a(e,"dragstart"),a(e,"dragend"),a(e,"dragover"),a(e,"dragenter"),a(e,"drop"),a(e,"mouseenter"),a(e,"mouseleave")},W=function(e,t){e&&a(e,"dragleave"),t&&t!==e&&a(t,"dragleave")},j=function(e,t){var n=e;return!0===E(t).getConfig("copy")&&(l(n=e.cloneNode(!0),"aria-copied","true"),e.parentElement.appendChild(n),n.style.display="none",n.oldDisplay=e.style.display),n},F=function(e){var t;(t=e).h5s&&delete t.h5s.data,r(e,"aria-dropeffect")},q=function(e){r(e,"aria-grabbed"),r(e,"aria-copied"),r(e,"draggable"),r(e,"role")};function R(e,t){if(t.composedPath)return t.composedPath().find(function(e){return e.isSortable});for(;!0!==e.isSortable;)e=e.parentElement;return e}function X(e,t){var n=c(e,"opts"),r=v(e.children,n.items).filter(function(e){return e.contains(t)||e.shadowRoot&&e.shadowRoot.contains(t)});return 0<r.length?r[0]:t}var B=function(e){var t=c(e,"opts"),n=v(e.children,t.items),r=s(n,t.handle);(l(e,"aria-dropeffect","move"),c(e,"_disabled","false"),l(r,"draggable","true"),h(e,!0),!1===t.disableIEFix)&&("function"==typeof(document||window.document).createElement("span").dragDrop&&i(r,"mousedown",function(){if(-1!==n.indexOf(this))this.dragDrop();else{for(var e=this.parentElement;-1===n.indexOf(e);)e=e.parentElement;e.dragDrop()}}))},k=function(e){var t=c(e,"opts"),n=v(e.children,t.items),r=s(n,t.handle);c(e,"_disabled","false"),N(n),W(S,P),a(r,"mousedown"),a(e,"dragover"),a(e,"dragenter"),a(e,"drop")};function U(e,h){var a=String(h);return h=h||{},"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLElement&&(e=[e]),e=Array.prototype.slice.call(e),/serialize/.test(a)?e.map(function(e){var t=c(e,"opts");return o(e,t.itemSerializer,t.containerSerializer)}):(e.forEach(function(s){if(/enable|disable|destroy/.test(a))return U[a](s);["connectWith","disableIEFix"].forEach(function(e){Object.prototype.hasOwnProperty.call(h,e)&&null!==h[e]&&console.warn('HTML5Sortable: You are using the deprecated configuration "'+e+'". This will be removed in an upcoming version, make sure to migrate to the new options when updating.')}),h=Object.assign({},D,E(s).config,h),E(s).config=h,c(s,"opts",h),s.isSortable=!0,k(s);var e,t=v(s.children,h.items);if(null!==h.placeholder&&void 0!==h.placeholder){var n=document.createElement(s.tagName);h.placeholder instanceof HTMLElement?n.appendChild(h.placeholder):n.innerHTML=h.placeholder,e=n.children[0]}E(s).placeholder=u(s,e,h.placeholderClass),c(s,"items",h.items),h.acceptFrom?c(s,"acceptFrom",h.acceptFrom):h.connectWith&&c(s,"connectWith",h.connectWith),B(s),l(t,"role","option"),l(t,"aria-grabbed","false"),i(s,"dragstart",function(e){var t=p(e);if(!0!==t.isSortable&&(e.stopImmediatePropagation(),(!h.handle||t.matches(h.handle))&&"false"!==t.getAttribute("draggable"))){var n=R(t,e),r=X(n,t);O=v(n.children,h.items),Y=O.indexOf(r),_=b(r,n.children),S=n,g(e,r,h.customDragImage),I=L(r),A=x(r),r.classList.add(h.draggingClass),l(H=j(r,n),"aria-grabbed","true"),n.dispatchEvent(new CustomEvent("sortstart",{detail:{origin:{elementIndex:_,index:Y,container:S},item:H,originalTarget:t}}))}}),i(s,"dragenter",function(e){var n=p(e),r=R(n,e);r&&r!==P&&(z=v(r.children,c(r,"items")).filter(function(e){return e!==E(s).placeholder}),h.dropTargetContainerClass&&r.classList.add(h.dropTargetContainerClass),r.dispatchEvent(new CustomEvent("sortenter",{detail:{origin:{elementIndex:_,index:Y,container:S},destination:{container:r,itemsBeforeUpdate:z},item:H,originalTarget:n}})),i(r,"dragleave",function(e){var t=e.relatedTarget||e.fromElement;e.currentTarget.contains(t)||(h.dropTargetContainerClass&&r.classList.remove(h.dropTargetContainerClass),r.dispatchEvent(new CustomEvent("sortleave",{detail:{origin:{elementIndex:_,index:Y,container:r},item:H,originalTarget:n}})))})),P=r}),i(s,"dragend",function(e){if(H){H.classList.remove(h.draggingClass),l(H,"aria-grabbed","false"),"true"===H.getAttribute("aria-copied")&&"true"!==c(H,"dropped")&&H.remove(),H.style.display=H.oldDisplay,delete H.oldDisplay;var t=Array.from(y.values()).map(function(e){return e.placeholder}).filter(function(e){return e instanceof HTMLElement}).filter(f)[0];t&&t.remove(),s.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:_,index:Y,container:S},item:H}})),A=I=H=P=null}}),i(s,"drop",function(e){if(M(s,H.parentElement)){e.preventDefault(),e.stopPropagation(),c(H,"dropped","true");var t=Array.from(y.values()).map(function(e){return e.placeholder}).filter(function(e){return e instanceof HTMLElement}).filter(f)[0];C(t,H),t.remove(),s.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:_,index:Y,container:S},item:H}}));var n=E(s).placeholder,r=v(S.children,h.items).filter(function(e){return e!==n}),o=!0===this.isSortable?this:this.parentElement,a=v(o.children,c(o,"items")).filter(function(e){return e!==n}),i=b(H,Array.from(H.parentElement.children).filter(function(e){return e!==n})),l=b(H,a);h.dropTargetContainerClass&&o.classList.remove(h.dropTargetContainerClass),_===i&&S===o||s.dispatchEvent(new CustomEvent("sortupdate",{detail:{origin:{elementIndex:_,index:Y,container:S,itemsBeforeUpdate:O,items:r},destination:{index:l,elementIndex:i,container:o,itemsBeforeUpdate:z,items:a},item:H}}))}});var o=d(function(t,e,n,r){if(H)if(h.forcePlaceholderSize&&(E(t).placeholder.style.height=I+"px",E(t).placeholder.style.width=A+"px"),-1<Array.from(t.children).indexOf(e)){var o=L(e),a=x(e),i=b(E(t).placeholder,e.parentElement.children),l=b(e,e.parentElement.children);if(I<o||A<a){var s=o-I,c=a-A,d=w(e).top,f=w(e).left;if(i<l&&("vertical"===h.orientation&&r<d||"horizontal"===h.orientation&&n<f))return;if(l<i&&("vertical"===h.orientation&&d+o-s<r||"horizontal"===h.orientation&&f+a-c<n))return}void 0===H.oldDisplay&&(H.oldDisplay=H.style.display),"none"!==H.style.display&&(H.style.display="none");var u=!1;try{var p=w(e).top+e.offsetHeight/2,m=w(e).left+e.offsetWidth/2;u="vertical"===h.orientation&&p<=r||"horizontal"===h.orientation&&m<=n}catch(e){u=i<l}u?C(e,E(t).placeholder):T(e,E(t).placeholder),Array.from(y.values()).filter(function(e){return void 0!==e.placeholder}).forEach(function(e){e.placeholder!==E(t).placeholder&&e.placeholder.remove()})}else{var g=Array.from(y.values()).filter(function(e){return void 0!==e.placeholder}).map(function(e){return e.placeholder});-1!==g.indexOf(e)||t!==e||v(e.children,h.items).length||(g.forEach(function(e){return e.remove()}),e.appendChild(E(t).placeholder))}},h.debounce),r=function(e){var t=e.target,n=!0===t.isSortable?t:R(t,e);if(t=X(n,t),H&&M(n,H.parentElement)&&"true"!==c(n,"_disabled")){var r=c(n,"opts");parseInt(r.maxItems)&&v(n.children,c(n,"items")).length>=parseInt(r.maxItems)&&H.parentElement!==n||(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect=!0===E(n).getConfig("copy")?"copy":"move",o(n,t,e.pageX,e.pageY))}};i(t.concat(s),"dragover",r),i(t.concat(s),"dragenter",r)}),e)}return U.destroy=function(e){var t,n,r,o;n=c(t=e,"opts")||{},r=v(t.children,n.items),o=s(r,n.handle),h(t,!1),a(t,"dragover"),a(t,"dragenter"),a(t,"dragstart"),a(t,"dragend"),a(t,"drop"),F(t),a(o,"mousedown"),N(r),q(r),W(S,P),t.isSortable=!1},U.enable=function(e){B(e)},U.disable=function(e){var t,n,r,o;n=c(t=e,"opts"),r=v(t.children,n.items),o=s(r,n.handle),l(t,"aria-dropeffect","none"),c(t,"_disabled","true"),l(o,"draggable","false"),a(o,"mousedown"),h(t,!1)},U.__testing={data:c,removeItemEvents:N,removeItemData:q,removeSortableData:F,removeContainerEvents:W},U}();

const apiKey = "0TvQnueqKa5mxJntVWt0w4LpLfEkrV1Ta8rQBb9Z";
var html_status;
var html_group;
var html_configOuter;
var html_configHint;
var html_configInner;
var html_configLeagueName;
var html_configTournamentSlugName;
var configHintTimer;

async function onLoad() {
   html_status = document.getElementById("status");
   html_group = document.getElementsByClassName("group")[0];
   html_configOuter = document.getElementById("configOuter");
   html_configHint = document.getElementById("configHint");
   html_configInner = document.getElementById("configInner");
   html_configLeagueName = document.getElementById("configLeagueName");
   html_configTournamentSlugName = document.getElementById("configTournamentSlugName");
   var urlargs = parseURLArgs();
   await loadStandings(urlargs);
   updateIndices();
   sortable("ul.group")[0].addEventListener('sortupdate', updateIndices);
   configHintTimer = setTimeout(hideConfigHint, 5000);
}
window.addEventListener('load', onLoad);

function parseURLArgs() {
   var argsStr = window.location.search.substr(1);
   if (argsStr === "")
      return [];
   var ret = argsStr.split("&");
   for (var i in ret)
      ret[i] = decodeURIComponent(ret[i]);
   return ret;
}

function hideConfigHint() {
   html_configHint.style.display = "none";
   configHintTimer = null;
}

function showConfigHint() {
   if (configHintTimer !== null)
      clearTimeout(configHintTimer);
   html_configHint.style.display = "block";
   configHintTimer = setTimeout(hideConfigHint, 5000);
}

function setConfig(leagueName, tournamentSlugName) {
   if (html_configLeagueName.value === "" && leagueName !== null)
      html_configLeagueName.value = leagueName;
   if (html_configTournamentSlugName.value === "" && tournamentSlugName !== null)
      html_configTournamentSlugName.value = tournamentSlugName;
}

function submitConfig() {
   var configLeagueName = encodeURIComponent(html_configLeagueName.value.trim());
   var configTournamentSlugName = encodeURIComponent(html_configTournamentSlugName.value.trim());
   var argsStr;
   if (configLeagueName === "") {
      if (configTournamentSlugName === "")
         argsStr = "";
      else
         argsStr = "LEC&" + configTournamentSlugName;
   } else {
      if (configTournamentSlugName === "")
         argsStr = configLeagueName;
      else
         argsStr = configLeagueName + "&" + configTournamentSlugName;
   }
   window.location.search = argsStr;
}

function logFormatted(level, color, ...args) {
   console.log("%c" + level, "border-radius:2px;padding:0 4px;color:white;background:" + color + ";", ...args);
}

function logInfo(...args) {
   logFormatted("info", "green", ...args);
}

function logWarning(...args) {
   logFormatted("warn", "yellow", ...args);
}

function logError(...args) {
   logFormatted("error", "red", ...args);
}

function setStatusPending(text) {
   html_status.innerText = text;
   html_status.style.backgroundColor = "yellow";
   html_status.style.display = "";
}

function setStatusError(text) {
   html_status.innerText = text;
   html_status.style.backgroundColor = "red";
   html_status.style.display = "";
}

function setStatusHidden() {
   html_status.style.display = "none";
}

async function getLeagues() {
   var reply = await fetch("https://esports-api.lolesports.com/persisted/gw/getLeagues?hl=en-GB", {
      "credentials": "omit",
      "headers": {
         "x-api-key": apiKey
      },
      "referrer": "https://lolesports.com/",
      "method": "GET",
      "mode": "cors"
   });
   var data = await reply.json();
   return data.data.leagues;
}

function getLeagueByName(leagues, leagueName) {
   for (var league of leagues)
      if (league.name === leagueName)
         return league;
   return null;
}

async function findLeague(leagueName) {
   var leagues = await getLeagues();
   return getLeagueByName(leagues, leagueName);
}

async function getTournamentsForLeague(leagueId) {
   var reply = await fetch("https://esports-api.lolesports.com/persisted/gw/getTournamentsForLeague?hl=en-GB&leagueId=" + leagueId, {
      "credentials": "omit",
      "headers": {
         "x-api-key": apiKey
      },
      "referrer": "https://lolesports.com/",
      "method": "GET",
      "mode": "cors"
   });
   var data = await reply.json();
   return data.data.leagues[0].tournaments;
}

function getTournamentLatest(tournaments) {
   var ret = tournaments[0];
   for (var tournament of tournaments)
      if (ret.startDate < tournament.startDate)
         ret = tournament;
   return ret;
}

function getTournamentBySlugName(tournaments, tournamentSlugName) {
   for (var tournament of tournaments)
      if (tournament.slug === tournamentSlugName)
         return tournament;
   return null;
}

async function findTournament(leagueId, tournamentSlugName) {
   var tournaments = await getTournamentsForLeague(leagueId);
   if (tournamentSlugName === null)
      return getTournamentLatest(tournaments);
   else
      return getTournamentBySlugName(tournaments, tournamentSlugName);
}

async function getStandings(tournamentId) {
   var reply = await fetch("https://esports-api.lolesports.com/persisted/gw/getStandings?hl=en-GB&tournamentId=" + tournamentId, {
      "credentials": "omit",
      "headers": {
         "x-api-key": apiKey
      },
      "referrer": "https://lolesports.com/",
      "method": "GET",
      "mode": "cors"
   });
   var data = await reply.json();
   return data.data.standings[0];
}

function getRegularSeasonRankings(standings) {
   return standings.stages[0].sections[0].rankings;
}

function createHTMLTeam(data) {
   var html_li = document.createElement("li");
   var html_a = document.createElement("a");
   html_a.href = "https://watch.lolesports.com/teams/" + data.slug;
   html_a.classList.add("ranking");
   html_li.appendChild(html_a);
   var ordinal = document.createElement("div");
   ordinal.classList.add("ordinal");
   html_a.appendChild(ordinal);
   var team = document.createElement("div");
   team.classList.add("team");
   html_a.appendChild(team);
   var teamLogo = document.createElement("div");
   teamLogo.classList.add("team-logo");
   team.appendChild(teamLogo);
   var logo = document.createElement("img");
   logo.src = data.image;
   logo.classList.add("logo");
   teamLogo.appendChild(logo);
   var teamInfo = document.createElement("div");
   teamInfo.classList.add("team-info");
   team.appendChild(teamInfo);
   var name = document.createElement("div");
   name.innerText = data.name;
   name.classList.add("name");
   teamInfo.appendChild(name);
   var record = document.createElement("div");
   record.innerText = data.record.wins + "W-" + data.record.losses + "L";
   record.classList.add("record");
   teamInfo.appendChild(record);
   return html_li;
}

async function loadStandings(urlargs) {
   setStatusPending("Loading rankings...");
   var leagueName = "LEC";
   var tournamentSlugName = null;
   if (0 < urlargs.length)
      leagueName = urlargs[0];
   if (1 < urlargs.length)
      tournamentSlugName = urlargs[1];
   setConfig(leagueName, tournamentSlugName);
   logInfo("Creating page for config: leagueName=\"" + leagueName + "\", tournamentSlugName=\"" + tournamentSlugName + "\"");
   var league = await findLeague(leagueName);
   if (league === null) {
      logError("Could not find the target league.");
      setStatusError("Could not find the target league!");
      return;
   }
   logInfo("Found league: name=\"" + league.name + "\", slug=\"" + league.slug + "\", region=\"" + league.region + "\", id=" + league.id);
   var tournament = await findTournament(league.id, tournamentSlugName);
   if (tournament === null) {
      logError("Could not find the target tournament.");
      setStatusError("Could not find the target tournament!");
      return;
   }
   logInfo("Found tournament: slug=\"" + tournament.slug + "\", id=" + tournament.id);
   var standings = await getStandings(tournament.id);
   if (standings === null) {
      logError("Could not fetch the desired standings.");
      setStatusError("Could not fetch the desired standings!");
      return;
   }
   logInfo("Received standings.");
   setStatusHidden();
   var rankings = getRegularSeasonRankings(standings);
   for (var rank of rankings) {
      for (var team of rank.teams) {
         var html_team = createHTMLTeam(team);
         html_group.appendChild(html_team);
      }
   }
}

function updateIndices() {
   var elems = html_group.children;
   for (var i = 0; i < elems.length; i++) {
      elems[i].getElementsByClassName("ordinal")[0].innerHTML = i + 1;
   }
}
   </script>
</head>
<body>
   <div id="status">
      Waiting for the page to load...
   </div>
   <div>
      <main class="Standings">
         <div class="results">
            <div class="stage">
               <div class="StandingsList num-groups-odd">
                  <ul class="group">
                  </ul>
               </div>
            </div>
         </div>
      </main>
   </div>
   <div id="configOuter">
      <div id="configHint">
         hover the bottom right corner to change league and tournament config
      </div>
      <div id="configInner">
         <table>
            <tr>
               <td>
                  <label for="configLeagueName">League Name</label>
               </td><td>
                  <input type="text" id="configLeagueName" />
               </td>
            </tr><tr>
               <td>
                  <label for="configTournamentSlugName">Tournament Slug Name</label>
               </td><td>
                  <input type="text" id="configTournamentSlugName" />
               </td>
            </tr>
         </table>
         <div class="right">
            <input type="button" value="reload page" onclick="submitConfig();" />
         </div>
      </div>
   </div>
</body>
</html>

